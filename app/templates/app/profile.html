<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    {% load static %}
    <meta charset="utf-8">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'app/favicon/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'app/favicon/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'app/favicon/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'app/favicon/site.webmanifest' %}">
        
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{{ user.username }}</title>

    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

     
        <link rel="stylesheet" href="{% static 'app/css/all.css' %}">

        <link rel="stylesheet" href="{% static 'app/css/bootstrap4-neon-glow.min.css' %}">

        <link rel='stylesheet' href="{% static 'app/css/hack.min.css' %}">
        
        <link rel="stylesheet" href="{% static 'app/css/main.css' %}">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.4/croppie.min.css" integrity="sha256-/n6IXDwJAYIh7aLVfRBdduQfdrab96XZR+YjG42V398=" crossorigin="anonymous" />
        

        
    
</head>

<body class="imgloaded">
    <div class="glitch">
        <div style="position: fixed;" class="glitch__img"></div>
        <div style="position: fixed;" class="glitch__img"></div>
        <div style="position: fixed;" class="glitch__img"></div>
        <div style="position: fixed;" class="glitch__img"></div>
        <div style="position: fixed;" class="glitch__img"></div>
    </div>
    <div class="navbar-dark text-white">
        <div class="container">
            <nav class="navbar px-0 py-0 navbar-expand-lg navbar-dark">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
                <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                    <div class="navbar-nav">
                        <a href="/" class="pl-md-0 p-3 text-decoration-none text-light">
                            <h3 class="bold"><span class="color_danger">LAKSHYA</span><span class="color_white">CTF</span></h3>
                        </a>
                    </div>
                    <div class="navbar-nav ml-auto">
                        <a href="/" class="p-3 text-decoration-none text-light bold">Home</a>
                        <a href="/about" class="p-3 text-decoration-none text-light bold">About</a>
                        <a href="/leaderboard" class="p-3 text-decoration-none text-light bold">Leaderboard</a>
                        <a href="/quest" class="p-3 text-decoration-none text-light bold">Challenges</a>
                        {% if  request.user.is_authenticated %}
                        <div class="btn-group" >
                            <a class="dropdown-toggle p-3 text-decoration-none text-light bold" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">
                            <svg class="bi bi-person-circle" width="1.5em" height="1.5em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path d="M13.468 12.37C12.758 11.226 11.195 10 8 10s-4.757 1.225-5.468 2.37A6.987 6.987 0 0 0 8 15a6.987 6.987 0 0 0 5.468-2.63z"/>
  <path fill-rule="evenodd" d="M8 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
  <path fill-rule="evenodd" d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8z"/>
</svg>
                          </a>
                          <div class="dropdown-menu" x-placement="bottom-start" style="">
                            <a class="dropdown-item text-decoration-none text-light bold" href="/user/{{request.user.username}}">My Profile</a>
                            <a class="dropdown-item text-decoration-none text-light bold" href="/password-reset/">Reset Password</a>
                            <div class="dropdown-divider"></div>
                            <a href="/logout" class="dropdown-item text-decoration-none text-light bold">Logout</a>
                          </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </nav>

        </div>
    </div>

    <div class="jumbotron bg-transparent mb-0 pt-3 radius-0">
        <div class="container">
            <div class="row">
                <div class="col-xl-12">
                    <div class="card">
                        <div class="row justify-content-center p-3">
                            <div class="col-md-3">
                                <div class="row justify-content-center">
                                    
                                    
                                    <div class="profile-img" title="click to change">
                                        <img id="profileImage"  src="{% static 'app/images/bg.jpg' %}" />
                                        
                                    </div>
                                    <input style="display: none;" id="imageUpload" type="file" name="profile_photo" placeholder="Photo" required="" capture>
                                        {%  endif %}
                                <h5 class="normalFont text-center mt-3">{{user.first_name}}&nbsp;{{user.last_name}}</h5>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div class="row" style="height:100%">
                                    <div class="col-md-3 text-center align-self-center">
                                        <h3 class="jumboNum">{{ user.points }}</h3>
                                        <h5 style="color:#9acc14">Points</h5>
                                    </div>
                                    <div class="col-md-3 text-center align-self-center">
                                        <h3 class="jumboNum">{{ challenges_solved }}</h3>
                                        <h5 style="color:#56c0e0">Challenges Solved</h5>
                                    </div>
                                    <div class="col-md-3 text-center align-self-center">
                                        <h3 class="jumboNum">{{ root_owns }}</h3>
                                        <h5 style="color:#56c0e0">Machine Owns</h5>
                                    </div>
                                    <div class="col-md-3 text-center align-self-center">
                                        <h3 class="jumboNum">{{ rank }}</h3>
                                        <h5 style="color:#d73e36">Rank</h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row my-5">
                        <div class="col-md-6">
                            <div class="row justify-content-center">
                                <h4 class="mb-5"> {{user.username}}'s Stats:</h4>
                                <div class="col-xl-10">
                                    <canvas id="myChart"></canvas>
                                </div>
                            </div>
                        </div>               
                        <div class="col-md-6">
                            <h4 class="mb-5">Challenges Solved:</h4>
                            <div class="col-xl-12">
                                <canvas id="chart"></canvas>
                            </div>
                        </div>
                        
                       
                    </div>
                   
                </div>
            </div>
        </div>
    </div>



    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
     <script src="{% static 'app/js/jquery-3.4.1.min.js' %}"></script>
        <script src="{% static 'app/js/popper.min.js' %}"></script>
        <script src="{% static 'app/js/bootstrap.min.js' %}"></script>
        <script src="{% static 'app/js/preloader.js' %}"></script>
        <script src="{% static 'app/js/moment.min.js' %}"></script>
        <script src="{% static 'app/js/chart.min.js' %}"></script>
        
  
    <script>
          
        $("#profileImage").click(function(e) {
            $("#imageUpload").click();
        });

        $(".hover-top").click(function(e) {
            $("#imageUpload").click();
        });

        function fasterPreview( uploader ) {
            if ( uploader.files && uploader.files[0] ){ 
                $('#profileImage').attr('src', window.URL.createObjectURL(uploader.files[0]) );
                // @ToDo : upload uploader.files[0] in our storage ( can use ajax )
            }
        }

        $("#imageUpload").change(function(){
            fasterPreview( this );
        });

        var values = [];

        {% for timestamp in timestamps %}
         values.push({x: '{{timestamp.convert}}', y: {{timestamp.points}} });

        {% endfor %}

        var s1 = {
            // @ToDo : Change the label to player's name
            label: '{{ user.username }}',
            borderColor: '#56c0e0',
            steppedLine: false,
            data: values
        };

        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {
            type: 'line',
            data: {
                datasets: [s1]
            },
            options: {
                scales: {
                    yAxes: [{
                        type: 'linear'
                    }],
                    xAxes: [{
                        type: 'time',
                        distribution: 'series', // or linear
                        time: {
                            unit: 'minute',
                            displayFormats: {
                                minute: 'hh:mm:ss'
                            },
                            tooltipFormat: 'hh:mm:ss'
                        }
                    }]
                },
                legend: {
                        display: false,
                    },
            }
        });
        var stats = [];
        {% for value in stats %}
            stats.push({{value}});
        {% endfor %}
        var barChartData = {
			labels: ['Web', 'Reversing', 'Steganography', 'Pwning', 'Cryptography', 'Other', 'Machines'],
			datasets: [{
				label: 'Percent solved',
				// backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
				// borderColor: window.chartColors.red,
				borderWidth: 1,
				data: stats,
				backgroundColor: [
					'#ef121b94',
					'#17b06b94',
					'#f9751594',
					'#00a09994',
					'#9966FF94',
					'#ffce5694',
					'#0f329894'
				]
			}]

        };
        
        var ctx2 = document.getElementById('chart').getContext('2d');
        window.myBar = new Chart(ctx2, {
            type: 'bar',
            data: barChartData,
            options: {
                responsive: true,
                legend: {
                        display: false
					},
                scales: {
                    xAxes: [{
                        gridLines: {
                            offsetGridLines: true
                        }
                    }],
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        });
    </script>
</body>

</html>